# Challenge 1: Orphan Response Hijacking

## 難易度: ★★☆☆☆（初級〜中級）

## シナリオ

あなたはセキュリティ研究者です。
とある企業の内部システムで使われている MCP サーバーに脆弱性があるという報告を受けました。

このサーバーには複数のユーザーがアクセスしており、各ユーザーの秘密情報を管理しています。
あなたは「guest」ユーザーとしてアクセスできますが、「admin」ユーザーの秘密情報（FLAG）を取得することが目標です。

## 目標

```
admin ユーザーの秘密情報（FLAG{...}）を取得せよ
```

## 難易度選択

### 🟢 Easy モード（入門者向け）
- サーバーのソースコード（`vulnerable_server.py`）を読んで脆弱性を理解する
- `exploit_template.py` の穴埋めを完成させる
- ヒント（hint1.txt, hint2.txt）を活用する

### 🟡 Normal モード（実践的）
- ソースコードは**読まない**
- 穴埋めテンプレートは**使わない**
- サーバーの挙動を観察して、ゼロから攻撃スクリプトを作成する
- `hint_blackbox.txt` のブラックボックステスト手法を参考にする

### 🔴 Hard モード（上級者向け）
- ヒントファイルは一切見ない
- 偵察 → 分析 → 攻撃構築をすべて自力で行う

## ルール

**共通ルール**:
- サーバーを直接改ざんするのは禁止
- FLAG形式は `FLAG{...}`

**Easyモード追加ルール**:
- ソースコードを読んでOK
- テンプレートとヒントを活用

**Normal/Hardモード追加ルール**:
- ソースコードは見ない（実際のペネトレーションテストを想定）
- サーバーの挙動のみから脆弱性を発見する

## ファイル構成

```
challenge1_orphan_hijack/
├── README.md              # この説明書
├── vulnerable_server.py   # 攻撃対象の脆弱なサーバー
├── exploit_template.py    # 穴埋め式の攻撃スクリプト（Easyモード用）
├── hint1.txt              # ヒント1：攻撃の方向性（Easyモード用）
├── hint2.txt              # ヒント2：具体的なテクニック（Easyモード用）
├── hint_blackbox.txt      # ブラックボックス攻撃の手法（Normal/Hardモード用）
└── solution.py            # 模範解答（最後の手段）
```

## 実行方法

### ステップ1: サーバーを起動

```bash
# ターミナル1
cd challenges/challenge1_orphan_hijack
../../venv/bin/python vulnerable_server.py
```

サーバーが起動すると以下のように表示されます：
```
[SERVER] 脆弱なMCPサーバー起動（Challenge 1: Orphan Hijack）
[SERVER] ポート: 9999
[SERVER] 登録ユーザー: admin, guest
```

### ステップ2: 攻撃スクリプトを実行

```bash
# ターミナル2（別のターミナルで）
cd challenges/challenge1_orphan_hijack
../../venv/bin/python exploit_template.py
```

### ステップ3: FLAGを取得

攻撃が成功すると、FLAG が表示されます。

## ヒント

### Easyモード向け（ソースコード参照OK）

行き詰まったら、以下のファイルを順番に見てください：

1. `hint1.txt` - 攻撃の方向性
2. `hint2.txt` - 具体的なテクニック
3. `solution.py` - 模範解答（ネタバレ注意）

### Normal/Hardモード向け（ブラックボックス）

ソースコードを見ずに攻撃する場合は：

1. `hint_blackbox.txt` - 偵察・分析・攻撃構築の手法

このファイルでは以下を解説しています：
- 利用可能なメソッドの列挙方法
- レスポンスIDパターンの分析
- タイミング分析とタイムアウト挙動の観察
- 隠しメソッドの発見テクニック
- 攻撃シナリオの構築プロセス

## 学習ポイント

この課題を通じて以下を学びます：

1. **orphan response とは何か** - タイムアウト後に返ってくる遅延レスポンス
2. **なぜ orphan を保存すると危険か** - 他ユーザーのデータが混入する可能性
3. **タイミング攻撃の基本** - タイムアウトを意図的に発生させる手法
4. **対策** - orphan を破棄する、暗号論的乱数 ID を使う

## 成功条件

`FLAG{...}` 形式の文字列を取得できれば成功です。

---

Good luck! 🎯
